<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì£¼ì‹ ê±°ë˜ ì‹œìŠ¤í…œ ERD (í™•ì¥)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .badge {
            display: inline-block;
            padding: 5px 15px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 12px;
            margin: 0 5px;
        }
        .badge.new {
            background: #28a745;
        }
        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .info-box.new {
            border-left-color: #28a745;
            background: #f0fdf4;
        }
        .info-box h3 {
            margin-top: 0;
            color: #667eea;
        }
        .info-box.new h3 {
            color: #28a745;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .legend-symbol {
            font-weight: bold;
            color: #667eea;
        }
        #erd-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
        }
        .mermaid {
            display: flex;
            justify-content: center;
        }
        .note {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .note strong {
            color: #856404;
        }
        .highlight {
            background: #e7f3ff;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
        .table-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .table-card {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }
        .table-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }
        .table-card.new {
            border-color: #28a745;
            background: #f0fdf4;
        }
        .table-card h4 {
            margin-top: 0;
            color: #667eea;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .table-card.new h4 {
            color: #28a745;
        }
        .table-card ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .table-card li {
            margin: 5px 0;
            font-size: 14px;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¦ ê°€ìƒ ì£¼ì‹ ê±°ë˜ ì‹œìŠ¤í…œ (í™•ì¥)</h1>
        <div class="subtitle">
            <span class="badge">ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤</span>
            <span class="badge">ERD</span>
            <span class="badge new">5ê°œ í…Œì´ë¸” ì¶”ê°€</span>
        </div>

        <div class="info-box">
            <h3>ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ê°œìš”</h3>
            <ul>
                <li><strong>ë°ì´í„°ë² ì´ìŠ¤ëª…:</strong> stock_trading</li>
                <li><strong>ì´ í…Œì´ë¸” ìˆ˜:</strong> <span class="highlight">9ê°œ</span> (ê¸°ì¡´ 4ê°œ + ì‹ ê·œ 5ê°œ)</li>
                <li><strong>ì£¼ìš” ê¸°ëŠ¥:</strong> ì‚¬ìš©ì ê´€ë¦¬, í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬, ê±°ë˜ ë‚´ì—­ ì¶”ì , ì£¼ì‹ ê°€ê²© ìºì‹±, ê´€ì‹¬ ì¢…ëª©, ê°€ê²© ì•Œë¦¼, í™˜ìœ¨ ì´ë ¥, ì•Œë¦¼ ì‹œìŠ¤í…œ, ë°°ë‹¹ ê´€ë¦¬</li>
            </ul>
        </div>

        <div class="legend">
            <div class="legend-item">
                <span class="legend-symbol">PK</span>
                <span>Primary Key (ê¸°ë³¸í‚¤)</span>
            </div>
            <div class="legend-item">
                <span class="legend-symbol">FK</span>
                <span>Foreign Key (ì™¸ë˜í‚¤)</span>
            </div>
            <div class="legend-item">
                <span class="legend-symbol">UK</span>
                <span>Unique Key (ê³ ìœ í‚¤)</span>
            </div>
            <div class="legend-item">
                <span class="legend-symbol">1:N</span>
                <span>One to Many (ì¼ëŒ€ë‹¤ ê´€ê³„)</span>
            </div>
        </div>

        <div id="erd-container">
            <div class="mermaid">
erDiagram
    USERS ||--o{ PORTFOLIOS : "ë³´ìœ "
    USERS ||--o{ TRANSACTIONS : "ê±°ë˜"
    USERS ||--o{ WATCHLIST : "ê´€ì‹¬ë“±ë¡"
    USERS ||--o{ STOCK_ALERTS : "ì•Œë¦¼ì„¤ì •"
    USERS ||--o{ USER_NOTIFICATIONS : "ì•Œë¦¼ë°›ìŒ"
    USERS ||--o{ DIVIDEND_HISTORY : "ë°°ë‹¹ë°›ìŒ"
    
    USERS {
        bigint id PK "ì‚¬ìš©ì ID"
        varchar username UK "ì‚¬ìš©ìëª…"
        varchar email UK "ì´ë©”ì¼"
        varchar password "ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸"
        decimal balance "ë³´ìœ  í˜„ê¸ˆ"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
        timestamp updated_at "ìˆ˜ì •ì¼ì‹œ"
    }
    
    PORTFOLIOS {
        bigint id PK "í¬íŠ¸í´ë¦¬ì˜¤ ID"
        bigint user_id FK "ì‚¬ìš©ì ID"
        varchar symbol "ì£¼ì‹ ì‹¬ë³¼"
        int quantity "ë³´ìœ  ìˆ˜ëŸ‰"
        decimal avg_price "í‰ê·  ë§¤ìˆ˜ê°€"
        varchar market "ì‹œì¥ KRW/USD"
        timestamp created_at "ìµœì´ˆ ë§¤ìˆ˜ì¼"
        timestamp updated_at "ë§ˆì§€ë§‰ ìˆ˜ì •ì¼"
    }
    
    TRANSACTIONS {
        bigint id PK "ê±°ë˜ ID"
        bigint user_id FK "ì‚¬ìš©ì ID"
        varchar symbol "ì£¼ì‹ ì‹¬ë³¼"
        varchar type "ê±°ë˜ìœ í˜• buy/sell"
        int quantity "ê±°ë˜ ìˆ˜ëŸ‰"
        decimal price "ê±°ë˜ ë‹¨ê°€"
        decimal commission "ê±°ë˜ ìˆ˜ìˆ˜ë£Œ"
        decimal total_amount "ì´ ê±°ë˜ê¸ˆì•¡"
        varchar market "ì‹œì¥"
        timestamp timestamp "ê±°ë˜ ì‹œê°"
    }
    
    STOCK_CACHE {
        bigint id PK "ìºì‹œ ID"
        varchar symbol UK "ì£¼ì‹ ì‹¬ë³¼"
        varchar name "íšŒì‚¬ëª…"
        decimal current_price "í˜„ì¬ê°€"
        decimal previous_close "ì „ì¼ ì¢…ê°€"
        decimal open_price "ì‹œê°€"
        decimal high_price "ê³ ê°€"
        decimal low_price "ì €ê°€"
        bigint volume "ê±°ë˜ëŸ‰"
        decimal change "ê°€ê²© ë³€ë™"
        decimal change_percent "ë³€ë™ë¥ "
        varchar market "ì‹œì¥"
        varchar currency "í†µí™”"
        decimal exchange_rate "í™˜ìœ¨"
        timestamp updated_at "ì—…ë°ì´íŠ¸ ì‹œê°"
    }
    
    WATCHLIST {
        bigint id PK "ê´€ì‹¬ì¢…ëª© ID"
        bigint user_id FK "ì‚¬ìš©ì ID"
        varchar symbol "ì£¼ì‹ ì‹¬ë³¼"
        varchar note "ë©”ëª¨"
        decimal target_price "ëª©í‘œê°€"
        timestamp added_at "ì¶”ê°€ì¼ì‹œ"
    }
    
    STOCK_ALERTS {
        bigint id PK "ì•Œë¦¼ ID"
        bigint user_id FK "ì‚¬ìš©ì ID"
        varchar symbol "ì£¼ì‹ ì‹¬ë³¼"
        varchar alert_type "ì•Œë¦¼ìœ í˜• above/below"
        decimal target_price "ëª©í‘œê°€"
        boolean is_active "í™œì„±ì—¬ë¶€"
        timestamp triggered_at "ë°œë™ì¼ì‹œ"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
    }
    
    USER_NOTIFICATIONS {
        bigint id PK "ì•Œë¦¼ ID"
        bigint user_id FK "ì‚¬ìš©ì ID"
        varchar type "ì•Œë¦¼íƒ€ì…"
        varchar title "ì œëª©"
        text message "ë‚´ìš©"
        boolean is_read "ì½ìŒì—¬ë¶€"
        varchar related_symbol "ê´€ë ¨ì¢…ëª©"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
    }
    
    DIVIDEND_HISTORY {
        bigint id PK "ë°°ë‹¹ ID"
        bigint user_id FK "ì‚¬ìš©ì ID"
        varchar symbol "ì£¼ì‹ ì‹¬ë³¼"
        decimal dividend_per_share "ì£¼ë‹¹ë°°ë‹¹ê¸ˆ"
        int quantity "ë³´ìœ ìˆ˜ëŸ‰"
        decimal total_dividend "ì´ë°°ë‹¹ê¸ˆ"
        date payment_date "ì§€ê¸‰ì¼"
        timestamp created_at "ê¸°ë¡ì¼ì‹œ"
    }
    
    EXCHANGE_RATES_HISTORY {
        bigint id PK "í™˜ìœ¨ ID"
        varchar currency_pair UK "í†µí™”ìŒ USD/KRW"
        decimal rate "í™˜ìœ¨"
        timestamp recorded_at "ê¸°ë¡ì¼ì‹œ"
    }
            </div>
        </div>

        <div class="info-box">
            <h3>ğŸ”— í…Œì´ë¸” ê´€ê³„ ì„¤ëª…</h3>
            <ul>
                <li><strong>USERS â†’ PORTFOLIOS (1:N)</strong> - í•œ ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ì£¼ì‹ì„ ë³´ìœ </li>
                <li><strong>USERS â†’ TRANSACTIONS (1:N)</strong> - í•œ ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ê±°ë˜ ë‚´ì—­</li>
                <li><strong class="highlight">USERS â†’ WATCHLIST (1:N)</strong> - í•œ ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ê´€ì‹¬ ì¢…ëª© ë“±ë¡ ğŸ†•</li>
                <li><strong class="highlight">USERS â†’ STOCK_ALERTS (1:N)</strong> - í•œ ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ê°€ê²© ì•Œë¦¼ ì„¤ì • ğŸ†•</li>
                <li><strong class="highlight">USERS â†’ USER_NOTIFICATIONS (1:N)</strong> - í•œ ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ì•Œë¦¼ ë°›ìŒ ğŸ†•</li>
                <li><strong class="highlight">USERS â†’ DIVIDEND_HISTORY (1:N)</strong> - í•œ ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ë°°ë‹¹ ë°›ìŒ ğŸ†•</li>
                <li><strong>STOCK_CACHE (ë…ë¦½)</strong> - ì£¼ì‹ ê°€ê²© ì •ë³´ ìºì‹±</li>
                <li><strong class="highlight">EXCHANGE_RATES_HISTORY (ë…ë¦½)</strong> - í™˜ìœ¨ ì´ë ¥ ì €ì¥ ğŸ†•</li>
            </ul>
        </div>

        <h2 style="text-align: center; color: #28a745; margin-top: 40px;">ğŸ†• ì‹ ê·œ í…Œì´ë¸” ìƒì„¸ ì •ë³´</h2>

        <div class="table-grid">
            <div class="table-card new">
                <h4>
                    <span>â­ WATCHLIST</span>
                    <span class="badge new">í•„ìˆ˜</span>
                </h4>
                <p><strong>ìš©ë„:</strong> ì‚¬ìš©ì ê´€ì‹¬ ì¢…ëª© ì €ì¥</p>
                <ul>
                    <li><strong>PK:</strong> id (bigint)</li>
                    <li><strong>FK:</strong> user_id â†’ users.id</li>
                    <li><strong>UK:</strong> (user_id, symbol)</li>
                    <li>note: ë©”ëª¨ (ìµœëŒ€ 500ì)</li>
                    <li>target_price: ëª©í‘œ ë§¤ìˆ˜ê°€</li>
                    <li>added_at: ì¶”ê°€ ì¼ì‹œ</li>
                </ul>
                <p><strong>ì‚¬ìš© ì˜ˆ:</strong> "ì‚¼ì„±ì „ìë¥¼ ê´€ì‹¬ ì¢…ëª©ì— ì¶”ê°€í•˜ê³  ëª©í‘œê°€ 75,000ì› ì„¤ì •"</p>
            </div>

            <div class="table-card new">
                <h4>
                    <span>ğŸ”” STOCK_ALERTS</span>
                    <span class="badge new">ê¶Œì¥</span>
                </h4>
                <p><strong>ìš©ë„:</strong> ì£¼ê°€ ì•Œë¦¼ ì„¤ì •</p>
                <ul>
                    <li><strong>PK:</strong> id (bigint)</li>
                    <li><strong>FK:</strong> user_id â†’ users.id</li>
                    <li>symbol: ì£¼ì‹ ì‹¬ë³¼</li>
                    <li>alert_type: 'above' ë˜ëŠ” 'below'</li>
                    <li>target_price: ì•Œë¦¼ ë°œë™ ê°€ê²©</li>
                    <li>is_active: í™œì„±í™” ì—¬ë¶€</li>
                    <li>triggered_at: ì•Œë¦¼ ë°œë™ ì‹œê°</li>
                </ul>
                <p><strong>ì‚¬ìš© ì˜ˆ:</strong> "ì• í”Œì´ 200ë‹¬ëŸ¬ ì´ìƒì´ë©´ ì•Œë¦¼"</p>
            </div>

            <div class="table-card new">
                <h4>
                    <span>ğŸ“¨ USER_NOTIFICATIONS</span>
                    <span class="badge new">ê¶Œì¥</span>
                </h4>
                <p><strong>ìš©ë„:</strong> í†µí•© ì•Œë¦¼ ì‹œìŠ¤í…œ</p>
                <ul>
                    <li><strong>PK:</strong> id (bigint)</li>
                    <li><strong>FK:</strong> user_id â†’ users.id</li>
                    <li>type: ì•Œë¦¼ íƒ€ì… (price_alert, trade_confirm, news)</li>
                    <li>title: ì•Œë¦¼ ì œëª©</li>
                    <li>message: ì•Œë¦¼ ë‚´ìš© (text)</li>
                    <li>is_read: ì½ìŒ ì—¬ë¶€</li>
                    <li>related_symbol: ê´€ë ¨ ì¢…ëª©</li>
                </ul>
                <p><strong>ì‚¬ìš© ì˜ˆ:</strong> "ì‚¼ì„±ì „ìê°€ ëª©í‘œê°€ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤"</p>
            </div>

            <div class="table-card new">
                <h4>
                    <span>ğŸ’° DIVIDEND_HISTORY</span>
                    <span class="badge">ì„ íƒ</span>
                </h4>
                <p><strong>ìš©ë„:</strong> ë°°ë‹¹ê¸ˆ ìˆ˜ë ¹ ë‚´ì—­</p>
                <ul>
                    <li><strong>PK:</strong> id (bigint)</li>
                    <li><strong>FK:</strong> user_id â†’ users.id</li>
                    <li>symbol: ì£¼ì‹ ì‹¬ë³¼</li>
                    <li>dividend_per_share: ì£¼ë‹¹ ë°°ë‹¹ê¸ˆ</li>
                    <li>quantity: ë³´ìœ  ìˆ˜ëŸ‰</li>
                    <li>total_dividend: ì´ ë°°ë‹¹ê¸ˆ</li>
                    <li>payment_date: ì§€ê¸‰ì¼</li>
                </ul>
                <p><strong>ì‚¬ìš© ì˜ˆ:</strong> "ì• í”Œ ì£¼ì‹ 10ì£¼ë¡œ ë°°ë‹¹ê¸ˆ $5 ìˆ˜ë ¹"</p>
            </div>

            <div class="table-card new">
                <h4>
                    <span>ğŸ’± EXCHANGE_RATES_HISTORY</span>
                    <span class="badge new">ê¶Œì¥</span>
                </h4>
                <p><strong>ìš©ë„:</strong> í™˜ìœ¨ ì´ë ¥ ì¶”ì </p>
                <ul>
                    <li><strong>PK:</strong> id (bigint)</li>
                    <li>currency_pair: í†µí™”ìŒ (USD/KRW)</li>
                    <li>rate: í™˜ìœ¨</li>
                    <li>recorded_at: ê¸°ë¡ ì‹œê°</li>
                    <li><strong>ë…ë¦½ í…Œì´ë¸”</strong> (ì™¸ë˜í‚¤ ì—†ìŒ)</li>
                </ul>
                <p><strong>ì‚¬ìš© ì˜ˆ:</strong> "2025ë…„ 1ì›”ì˜ USD/KRW í™˜ìœ¨ ë³€í™” ì¶”ì´"</p>
            </div>
        </div>

        <div class="info-box new">
            <h3>âœ¨ ì‹ ê·œ í…Œì´ë¸” ì¶”ê°€ë¡œ ê°€ëŠ¥í•´ì§€ëŠ” ê¸°ëŠ¥</h3>
            <ul>
                <li><strong>WATCHLIST:</strong> ê´€ì‹¬ ì¢…ëª© ê´€ë¦¬, ë§¤ìˆ˜ ì „ ëª¨ë‹ˆí„°ë§</li>
                <li><strong>STOCK_ALERTS:</strong> ê°€ê²© ì•Œë¦¼, ìë™ ë§¤ë§¤ ì¤€ë¹„</li>
                <li><strong>USER_NOTIFICATIONS:</strong> í†µí•© ì•Œë¦¼í•¨, í‘¸ì‹œ ì•Œë¦¼</li>
                <li><strong>DIVIDEND_HISTORY:</strong> ë°°ë‹¹ ìˆ˜ìµ ì¶”ì , ì„¸ê¸ˆ ê³„ì‚°</li>
                <li><strong>EXCHANGE_RATES_HISTORY:</strong> í™˜ì°¨ìµ/í™˜ì°¨ì† ê³„ì‚°, í™˜ìœ¨ ì°¨íŠ¸</li>
            </ul>
        </div>

        <div class="info-box">
            <h3>ğŸ“‹ CREATE TABLE ìŠ¤í¬ë¦½íŠ¸</h3>
            <pre>
-- 1. WATCHLIST (ê´€ì‹¬ ì¢…ëª©)
CREATE TABLE watchlist (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    symbol VARCHAR(20) NOT NULL,
    note VARCHAR(500),
    target_price DECIMAL(15,2),
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_symbol (user_id, symbol)
);

-- 2. STOCK_ALERTS (ê°€ê²© ì•Œë¦¼)
CREATE TABLE stock_alerts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    symbol VARCHAR(20) NOT NULL,
    alert_type VARCHAR(20) NOT NULL CHECK (alert_type IN ('above', 'below')),
    target_price DECIMAL(15,2) NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    triggered_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_active (user_id, is_active),
    INDEX idx_symbol_active (symbol, is_active)
);

-- 3. USER_NOTIFICATIONS (ì•Œë¦¼)
CREATE TABLE user_notifications (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    type VARCHAR(50) NOT NULL,
    title VARCHAR(200) NOT NULL,
    message TEXT,
    is_read BOOLEAN DEFAULT FALSE,
    related_symbol VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_unread (user_id, is_read, created_at)
);

-- 4. DIVIDEND_HISTORY (ë°°ë‹¹ ì´ë ¥)
CREATE TABLE dividend_history (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    symbol VARCHAR(20) NOT NULL,
    dividend_per_share DECIMAL(10,2) NOT NULL,
    quantity INT NOT NULL,
    total_dividend DECIMAL(15,2) NOT NULL,
    payment_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_date (user_id, payment_date)
);

-- 5. EXCHANGE_RATES_HISTORY (í™˜ìœ¨ ì´ë ¥)
CREATE TABLE exchange_rates_history (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    currency_pair VARCHAR(10) NOT NULL,
    rate DECIMAL(10,4) NOT NULL,
    recorded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_pair_time (currency_pair, recorded_at)
);
            </pre>
        </div>

        <div class="info-box">
            <h3>ğŸ” ì¸ë±ìŠ¤ ì „ì²´ ëª©ë¡</h3>
            <pre>
-- USERS
CREATE UNIQUE INDEX idx_users_email ON users(email);
CREATE UNIQUE INDEX idx_users_username ON users(username);

-- PORTFOLIOS
CREATE UNIQUE INDEX idx_portfolios_user_symbol ON portfolios(user_id, symbol);
CREATE INDEX idx_portfolios_user_id ON portfolios(user_id);
CREATE INDEX idx_portfolios_symbol ON portfolios(symbol);

-- TRANSACTIONS
CREATE INDEX idx_transactions_user_id ON transactions(user_id);
CREATE INDEX idx_transactions_symbol ON transactions(symbol);
CREATE INDEX idx_transactions_timestamp ON transactions(timestamp DESC);
CREATE INDEX idx_transactions_user_timestamp ON transactions(user_id, timestamp DESC);

-- STOCK_CACHE
CREATE UNIQUE INDEX idx_stock_cache_symbol ON stock_cache(symbol);
CREATE INDEX idx_stock_cache_updated_at ON stock_cache(updated_at DESC);

-- WATCHLIST (ì‹ ê·œ)
CREATE UNIQUE INDEX idx_watchlist_user_symbol ON watchlist(user_id, symbol);
CREATE INDEX idx_watchlist_symbol ON watchlist(symbol);

-- STOCK_ALERTS (ì‹ ê·œ)
CREATE INDEX idx_alerts_user_active ON stock_alerts(user_id, is_active);
CREATE INDEX idx_alerts_symbol_active ON stock_alerts(symbol, is_active);

-- USER_NOTIFICATIONS (ì‹ ê·œ)
CREATE INDEX idx_notif_user_unread ON user_notifications(user_id, is_read, created_at);
CREATE INDEX idx_notif_symbol ON user_notifications(related_symbol);

-- DIVIDEND_HISTORY (ì‹ ê·œ)
CREATE INDEX idx_dividend_user_date ON dividend_history(user_id, payment_date);
CREATE INDEX idx_dividend_symbol ON dividend_history(symbol);

-- EXCHANGE_RATES_HISTORY (ì‹ ê·œ)
CREATE INDEX idx_exchange_pair_time ON exchange_rates_history(currency_pair, recorded_at);
            </pre>
        </div>

        <div class="info-box">
            <h3>ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ ì¿¼ë¦¬</h3>
            
            <h4>1ï¸âƒ£ ê´€ì‹¬ ì¢…ëª© ì¡°íšŒ (í˜„ì¬ê°€ í¬í•¨)</h4>
            <pre>
SELECT 
    w.symbol,
    w.note,
    w.target_price,
    s.name,
    s.current_price,
    s.change_percent,
    CASE 
        WHEN s.current_price >= w.target_price THEN 'ëª©í‘œê°€ ë„ë‹¬'
        ELSE 'ëª©í‘œê°€ ë¯¸ë„ë‹¬'
    END as status
FROM watchlist w
JOIN stock_cache s ON w.symbol = s.symbol
WHERE w.user_id = 1
ORDER BY w.added_at DESC;
            </pre>

            <h4>2ï¸âƒ£ í™œì„± ì•Œë¦¼ ì²´í¬ (ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…)</h4>
            <pre>
SELECT 
    sa.id,
    sa.user_id,
    sa.symbol,
    sa.alert_type,
    sa.target_price,
    sc.current_price
FROM stock_alerts sa
JOIN stock_cache sc ON sa.symbol = sc.symbol
WHERE sa.is_active = TRUE
  AND (
      (sa.alert_type = 'above' AND sc.current_price >= sa.target_price) OR
      (sa.alert_type = 'below' AND sc.current_price <= sa.target_price)
  );
            </pre>

            <h4>3ï¸âƒ£ ì½ì§€ ì•Šì€ ì•Œë¦¼ ì¡°íšŒ</h4>
            <pre>
SELECT 
    type,
    title,
    message,
    related_symbol,
    created_at
FROM user_notifications
WHERE user_id = 1 
  AND is_read = FALSE
ORDER BY created_at DESC
LIMIT 20;
            </pre>

            <h4>4ï¸âƒ£ ì´ ë°°ë‹¹ê¸ˆ ìˆ˜ë ¹ì•¡ ê³„ì‚°</h4>
            <pre>
SELECT 
    YEAR(payment_date) as year,
    SUM(total_dividend) as total_received,
    COUNT(*) as payment_count
FROM dividend_history
WHERE user_id = 1
GROUP BY YEAR(payment_date)
ORDER BY year DESC;
            </pre>

            <h4>5ï¸âƒ£ í™˜ìœ¨ ë³€ë™ ì¶”ì´ (ìµœê·¼ 30ì¼)</h4>
            <pre>
SELECT 
    DATE(recorded_at) as date,
    AVG(rate) as avg_rate,
    MIN(rate) as min_rate,
    MAX(rate) as max_rate
FROM exchange_rates_history
WHERE currency_pair = 'USD/KRW'
  AND recorded_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY DATE(recorded_at)
ORDER BY date;
            </pre>
        </div>

        <div class="note">
            <strong>âš ï¸ ì°¸ê³ :</strong> ì´ ERDëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤(MySQL/PostgreSQL) ê¸°ì¤€ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. 
            ì‹¤ì œ êµ¬í˜„ì€ MongoDBë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°, í•„ìš”ì‹œ ì´ êµ¬ì¡°ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>

        <div class="info-box">
            <h3>ğŸ“ˆ êµ¬í˜„ ìš°ì„ ìˆœìœ„</h3>
            <ol>
                <li><strong>WATCHLIST</strong> â­â­â­ - ë¹ ë¥¸ êµ¬í˜„, ë†’ì€ íš¨ìš©, 2-3ì‹œê°„</li>
                <li><strong>STOCK_ALERTS</strong> â­â­ - ì‚¬ìš©ì ì°¸ì—¬ë„ í–¥ìƒ, 5-8ì‹œê°„</li>
                <li><strong>EXCHANGE_RATES_HISTORY</strong> â­â­ - ë¯¸êµ­ ì£¼ì‹ ì •í™•ë„, 2-3ì‹œê°„</li>
                <li><strong>USER_NOTIFICATIONS</strong> â­ - í†µí•© ì•Œë¦¼ ì‹œìŠ¤í…œ, 8-12ì‹œê°„</li>
                <li><strong>DIVIDEND_HISTORY</strong> â­ - ê³ ê¸‰ ê¸°ëŠ¥, 4-6ì‹œê°„</li>
            </ol>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#5568d3',
                lineColor: '#5568d3',
                secondaryColor: '#764ba2',
                tertiaryColor: '#f8f9fa'
            }
        });
    </script>
</body>
</html>
